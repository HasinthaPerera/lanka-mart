<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lanka-Mart | Products</title>
  <link rel="stylesheet" href="product.css">
</head>
<body>

  <header>
    <div class="container">
      <h1 class="logo">Lanka-Mart</h1>
      <nav>
        <a href="index.html">Home</a>
        <a href="products.html" class="active">Products</a>
        <a href="cart.html">Cart</a>
        <a href="contact.html">Contact</a>
        <li><a href="login.html" id="auth-link"><i class="fas fa-user"></i> Login</a></li>
      </nav>
    </div>
  </header>

  <section class="products-section">
    <h2>Our Products</h2>

    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="Search for products...">
    </div>

    <div class="category-container">
      <button class="cat-btn active" onclick="filterSelection('all')">All</button>
      <button class="cat-btn" onclick="filterSelection('vegetables')">Vegetables</button>
      <button class="cat-btn" onclick="filterSelection('fruits')">Fruits</button>
      <button class="cat-btn" onclick="filterSelection('spices')">Spices</button>
      <button class="cat-btn" onclick="filterSelection('rice')">Rice & Grains</button>
      <button class="cat-btn" onclick="filterSelection('textiles')">Textiles</button>
    </div>

    <div class="product-grid" id="product-list">
     
      <div class="product-card" data-category="textiles" data-name="Cotton Saree" data-price="1350" data-phone="94725105791" data-discount="10">
        <span class="discount-badge">10% OFF</span>
        <img src="Images/cotton saree.webp" alt="Textile">
        <h3>Cotton Saree</h3>
        <div class="price-container">
        <span class="old-price">LKR 1500</span>
        <span class="new-price">LKR 1350</span>
    </div>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div> 


     <div class="product-card" data-category="textiles" data-name="Cotton Shirt" data-price="937.5" data-discount="25">
        <span class="discount-badge">25% OFF</span>
        <img src="Images/cotton shirt.webp" alt="Textile">
        <h3>Cotton Shirt</h3>
         <div class="price-container">
        <span class="old-price">LKR 1250</span>
        <span class="new-price">LKR 937.50</span>
    </div>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>


      <div class="product-card" data-category="rice" data-name="White Rice" data-price="185">
        <img src="Images/white Rice.webp" alt="Rice">
        <h3>White Rice (1kg)</h3>
        <p>LKR 185</p>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>

      <div class="product-card" data-category="rice" data-name="Red Rice" data-price="180">
        <img src="Images/Red rice.webp" alt="Rice">
        <h3>Red Rice (1kg)</h3>
        <p>LKR 180</p>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>

      
       

 <div class="product-card" data-category="textiles" data-name="Cotton Shirt" data-price="720" data-discount="20">
        <span class="discount-badge">20% OFF</span>
        <img src="Images/tea powder.webp" alt="Tea Pack">
        <h3>Tea Powder (1kg)</h3>
         <div class="price-container">
        <span class="old-price">LKR 900</span>
        <span class="new-price">LKR 720</span>
    </div>
 <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>


      <div class="product-card" data-category="spices" data-name="chilli powder (250g)" data-price="240">
        <img src="Images/chilli powder.webp" alt="chilli powder">
        <h3>Chilli Powder (250g)</h3>
        <p>LKR 240</p>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>
     
      <div class="product-card" data-category="spices" data-name="pepper powder (250g)" data-price="300">
        <img src="Images/pepper powder.webp " alt="pepper powder">
        <h3>Pepper Powder (250g)</h3>
        <p>LKR 300</p>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>
 
      <div class="product-card" data-category="spices" data-name="turmeric powder (250g)" data-price="220">
        <img src="Images/tumeric powder.webp " alt="turmeric powder">
        <h3>Turmeric Powder (250g)</h3>
        <p>LKR 220</p>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>
 
      <div class="product-card" data-category="spices" data-name="curry powder (250g)" data-price="210">
        <img src="Images/curry powder.webp" alt="curry powder">
        <h3>Curry Powder (250g)</h3>
        <p>LKR 210</p>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>

      <div class="product-card" data-category="vegetables" data-name="Coconuts" data-price="150">
        <img src="Images/coconuts.webp" alt="Coconuts">
        <h3>Coconuts</h3>
        <p>LKR 150</p>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>

      <div class="product-card" data-category="vegetables" data-name="Onions (1kg)" data-price="162" data-discount="10">
        <img src="Images/onion.webp" alt="Onions">
        <span class="discount-badge">10% OFF</span>
        <h3>Onions (1kg)</h3>
         <div class="price-container">
            <span class="old-price">LKR 180</span>
            <span class="new-price">LKR 162</span>
        </div>

        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>

      <div class="product-card" data-category="vegetables" data-name="potatoes" data-price="160">
        <img src="Images/potatoes.webp" alt="potatoes">
        <h3>Potatoes (Lanka)</h3>
        <p>LKR 160</p>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>

      <div class="product-card" data-category="vegetables" data-name="Carrots (1kg)" data-price="140">
        <img src="Images/carrot.webp" alt="Carrots">
        <h3>Carrots (1kg)</h3>
        <p>LKR 140</p>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>
     
      <div class="product-card" data-category="vegetables" data-name="Tomatoes" data-price="150" data-phone="94714736314">
        <img src="Images/tomatoe.webp" alt="Tomatoes">
        <h3>Tomatoes (1kg)</h3>
        <p>LKR 150</p>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>

      <div class="product-card" data-category="fruits" data-name="Apples (1kg)" data-price="300">
        <img src="Images/apple.webp" alt="Apples">
        <h3>Apples (1kg)</h3>
        <p>LKR 300</p>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>

      <div class="product-card" data-category="fruits" data-name="Banana" data-price="100">
        <img src="Images/banana.webp" alt="Banana">
        <h3>Banana (1kg)</h3>
        <p>LKR 100</p>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>

      <div class="product-card" data-category="fruits" data-name="papaw" data-price="150" data-phone="94704574568">
        <img src="Images/papaw.webp" alt="papaw">
        <h3>Papaw (1kg)</h3>
        <p>LKR 150</p>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>
      <div class="product-card" data-category="fruits" data-name="pineapple" data-price="260" data-phone="94719488311">
        <img src="Images/pineapple.webp" alt="pineapple">
        <h3>Pineapple (1kg)</h3>
        <p>LKR 260</p>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>
      <div class="product-card" data-category="fruits" data-name="mango" data-price="130" data-phone="94713158065">
        <img src="Images/mango.webp" alt="mango">
        <h3>Mango (1kg)</h3>
        <p>LKR 130</p>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>
      <div class="product-card" data-category="fruits" data-name="dragonfruit" data-price="200" data-phone="94713158065">
        <img src="Images/dragonfruit.webp" alt="dragonfruit">
        <h3>Dragonfruit (1kg)</h3>
        <p>LKR 200</p>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>
      <div class="product-card" data-category="fruits" data-name="avacardo" data-price="120">
        <img src="Images/avacardo.webp" alt="avacardo">
        <h3>Avocado (1kg)</h3>
        <p>LKR 120</p>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>
      <div class="product-card" data-category="fruits" data-name="anona" data-price="230">
        <img src="Images/anona.webp" alt="anona">
        <h3>Anona (1kg)</h3>
        <p>LKR 230</p>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>
      <div class="product-card" data-category="fruits" data-name="grapes" data-price="350">
        <img src="Images/grapes.webp" alt="grapes">
        <h3>Grapes (1kg)</h3>
        <p>LKR 350</p>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>
      <div class="product-card" data-category="fruits" data-name="orange" data-price="130">
        <img src="Images/orange.webp" alt="orange">
        <h3>Orange (1kg)</h3>
        <p>LKR 130</p>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>

      <div class="product-card" data-category="fruits" data-name="strawberry" data-price="580">
        <img src="Images/strawberry.webp" alt="strawberry">
        <h3>strawberry (1kg)</h3>
        <p>LKR 580</p>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>
    
<div class="product-card" data-category="fruits" data-name="watermelon" data-price="125">
        <img src="Images/watermelon.webp" alt="watermelon">
        <h3>watermelon (1kg)</h3>
        <p>LKR 130</p>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>
 
<div class="product-card" data-category="fruits" data-name="Pomegranate" data-price="736" data-discount="20">
    
    <span class="discount-badge">20% OFF</span>

    <img src="Images/pomegranate.webp" alt="pomegranate">
    <h3>Pomegranate (1kg)</h3>
    
    <div class="price-container">
        <span class="old-price">LKR 920</span>
        <span class="new-price">LKR 736</span>
    </div>

    <div class="button-group">
        <button class="add-btn" onclick="addToCart(this)">Add to Cart</button>
        <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
    </div>
</div>

<div class="product-card" data-category="fruits" data-name="durian" data-price="459" data-discount="15">
  <span class="discount-badge">15% OFF</span>
        <img src="Images/durian.webp" alt="durian">
        <h3>Durian (1kg)</h3>

        <div class="price-container">
            <span class="old-price">LKR 540</span>
            <span class="new-price">LKR 459</span>
        </div>
        <div class="button-group">
            <button onclick="addToCart(this)">Add to Cart</button>
            <button class="btn-contact" onclick="contactSeller(this)">Contact Seller</button>
        </div>
      </div>

    </div>
  </section>


  <footer>
    <p>© 2026 Lanka-Mart | Freshness & Quality at Your Doorstep</p>
  </footer>


  <div id="review-modal" class="modal">
  <div class="modal-content">
    <span class="close-modal" onclick="closeReviewModal()">&times;</span>
    <h2 id="modal-product-name" style="margin-bottom: 20px;">Product Reviews</h2>
    
    <div class="review-form" style="background: #f9f9f9; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
        <h4 style="margin-top:0;">Write a Review</h4>
        
        <div class="star-rating">
            <input type="radio" id="star5" name="rating" value="5"><label for="star5">★</label>
            <input type="radio" id="star4" name="rating" value="4"><label for="star4">★</label>
            <input type="radio" id="star3" name="rating" value="3"><label for="star3">★</label>
            <input type="radio" id="star2" name="rating" value="2"><label for="star2">★</label>
            <input type="radio" id="star1" name="rating" value="1"><label for="star1">★</label>
        </div>
        
        <input type="text" id="review-name" placeholder="Your Name" style="width:100%; padding:8px; margin-bottom:5px; border:1px solid #ddd; border-radius:5px;">
        <textarea id="review-text" placeholder="Share your experience with this product..."></textarea>
        <button class="btn-submit-review" onclick="submitReview()">Submit Review</button>
    </div>

    <h4 style="border-bottom: 2px solid #eee; padding-bottom: 10px;">Customer Feedback</h4>
    <div id="reviews-list">
        <p style="color:gray; text-align:center;">Loading reviews...</p>
    </div>
  </div>
</div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    // 1. ADDED imports for reviews: addDoc, query, where
    import { getFirestore, collection, getDocs, addDoc, query, where, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { firebaseConfig } from './config.js'; 

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let allProducts = [];
    let currentProductId = null; // To track which product we are reviewing
    const grid = document.getElementById('product-list');

    // --- LOAD PRODUCTS ---
    async function loadProducts() {
        try {
            const snapshot = await getDocs(collection(db, "products"));
            allProducts = [];
            snapshot.forEach(doc => allProducts.push({ id: doc.id, ...doc.data() }));
            renderProducts(allProducts);
        } catch (error) { console.error(error); }
    }

    // --- RENDER PRODUCTS ---
    function renderProducts(items) {
        grid.innerHTML = "";
        if(items.length === 0) { grid.innerHTML = '<p>No products found.</p>'; return; }

        items.forEach(product => {
            const card = document.createElement('div');
            card.className = 'product-card';
            
            card.innerHTML = `
                <img src="${product.imageUrl}" alt="${product.name}" onerror="this.src='Images/placeholder.png'">
                <h3>${product.name}</h3>
                <div class="price-container"><span class="new-price">LKR ${product.price}</span></div>
                
                <div class="button-group">
                    <button onclick="addToCart('${product.name}', ${product.price})">Add to Cart</button>
                    <button class="btn-contact" onclick="contactSeller('${product.name}', ${product.price})">Contact</button>
                </div>
                <button onclick="window.openReviews('${product.id}', '${product.name}')" style="background:none; border:none; color:#f59e0b; cursor:pointer; margin-top:10px; font-size:0.9rem; width:100%;">
                    <i class="fas fa-star"></i> See Reviews
                </button>
            `;
            grid.appendChild(card);
        });
    }
=
    // 1. OPEN MODAL
    window.openReviews = (id, name) => {
        currentProductId = id;
        document.getElementById('modal-product-name').innerText = `Reviews: ${name}`;
        document.getElementById('review-modal').style.display = "block";
        loadReviews(id); // Load existing comments
    };

    // 2. CLOSE MODAL
    window.closeReviewModal = () => {
        document.getElementById('review-modal').style.display = "none";
    };

    // 3. SUBMIT A REVIEW
    window.submitReview = async () => {
        const name = document.getElementById('review-name').value;
        const text = document.getElementById('review-text').value;
        // Get selected star rating
        const ratingEl = document.querySelector('input[name="rating"]:checked');
        const rating = ratingEl ? ratingEl.value : 0;

        if(!name || !text || rating === 0) {
            alert("Please fill in your name, a rating, and a comment.");
            return;
        }

        try {
            // Save to "reviews" collection
            await addDoc(collection(db, "reviews"), {
                productId: currentProductId,
                user: name,
                rating: parseInt(rating),
                comment: text,
                date: new Date()
            });

            alert("Review Submitted!");
            // Clear form
            document.getElementById('review-text').value = "";
            // Reload list
            loadReviews(currentProductId);
        } catch (err) {
            console.error(err);
            alert("Error submitting review.");
        }
    };

    // 4. LOAD REVIEWS FROM DB
    async function loadReviews(prodId) {
        const list = document.getElementById('reviews-list');
        list.innerHTML = "Loading...";

        try {
            // Get reviews ONLY for this product
            const q = query(collection(db, "reviews"), where("productId", "==", prodId));
            const snapshot = await getDocs(q);

            if (snapshot.empty) {
                list.innerHTML = "<p>No reviews yet. Be the first!</p>";
                return;
            }

            let html = "";
            snapshot.forEach(doc => {
                const r = doc.data();
                // Create star string (e.g., "★★★★★")
                const stars = "★".repeat(r.rating) + "☆".repeat(5 - r.rating);
                
                html += `
                    <div class="review-item">
                        <div class="review-header">
                            <span class="review-user">${r.user}</span>
                            <span class="review-stars">${stars}</span>
                        </div>
                        <div class="review-text">${r.comment}</div>
                    </div>
                `;
            });
            list.innerHTML = html;

        } catch (err) {
            console.error(err);
            list.innerHTML = "<p>Error loading reviews.</p>";
        }
    }

    // Close modal when clicking outside
    window.onclick = (event) => {
        const modal = document.getElementById('review-modal');
        if (event.target == modal) modal.style.display = "none";
    }

    // Existing functions (Search, Cart, Contact) remain unchanged...
    window.filterSelection = (cat) => { /* ... keep your existing code ... */ };
    window.addToCart = (n, p) => { /* ... keep your existing code ... */ };
    window.contactSeller = (n, p) => { /* ... keep your existing code ... */ };

    // Start
    loadProducts();
</script>
</body>
</html>
